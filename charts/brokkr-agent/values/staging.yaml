---
# Staging Configuration for Brokkr Agent
# ========================================
# This file contains staging settings that mirror production configuration
# but with moderate resource allocation for testing and validation.
#
# Purpose:
#   - Test production RBAC configuration
#   - Validate agent behavior in production-like environment
#   - Integration testing with staging broker
#   - Performance testing with realistic settings
#
# Usage:
#   helm install brokkr-agent-staging . -f values/staging.yaml \
#     --set broker.agentName=staging-cluster-01 \
#     --set broker.clusterName=staging-us-east-1 \
#     --set broker.pak=<pre-authenticated-key>
#
# IMPORTANT: Review and customize the following before deploying:
#   - broker.url (your staging broker endpoint)
#   - broker.agentName (unique identifier for this agent)
#   - broker.clusterName (staging cluster identifier)

# Image Configuration
image:
  repository: ghcr.io/colliery-io/brokkr-agent
  # Staging: Use release candidates or pre-release versions
  # Examples: v1.0.0-rc1, v1.2.3-beta, 2024.01.15-staging
  tag: "v1.0.0-rc1"
  pullPolicy: IfNotPresent

# Single replica
replicaCount: 1

# Broker Connection Configuration
broker:
  # Staging broker endpoint
  # Should point to broker deployed with values/staging.yaml
  # Examples:
  #   - With ingress: https://brokkr-staging.internal.example.com
  #   - Internal service: http://brokkr-broker-staging.brokkr-staging.svc.cluster.local:3000
  url: "https://brokkr-staging.internal.example.com"

  # Staging agent identifier
  # Use naming convention that indicates staging environment
  # Examples: staging-cluster-01, staging-us-east-1, staging-gke-test
  agentName: ""

  # Staging cluster identifier
  clusterName: ""

  # Pre-Authenticated Key (REQUIRED)
  # Obtain from staging broker when registering agent
  pak: ""

# Agent Behavior Configuration
agent:
  # Staging: Same as production to test realistic behavior
  pollingInterval: 30

# RBAC Configuration
rbac:
  create: true

  # Staging: Use cluster-wide RBAC to test production configuration
  # This ensures RBAC issues are caught before production
  clusterWide: true

  additionalRules: []

# Service Account
serviceAccount:
  create: true
  # Optional: Custom name for staging service account
  # name: "brokkr-agent-staging"

# Resource Limits
# Moderate resources - less than production but realistic
resources:
  requests:
    memory: "128Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "200m"

# Security Context
# Full production security settings to catch issues early
securityContext:
  runAsNonRoot: true
  runAsUser: 10001
  fsGroup: 10001
  # Enable seccomp to test compatibility
  seccompProfile:
    type: RuntimeDefault

# Additional Environment Variables
extraEnv:
  # Staging: Use info level logging (between debug and production)
  - name: RUST_LOG
    value: "info"
  # Example: Tag staging environment for observability
  # - name: ENVIRONMENT
  #   value: "staging"
